define(["jquery","jqueryui","local_roomsupport/select2"],function(o,e,a){"use strict";function t(){var e;o("#changeCampusSelectContainer").hide(),o("#changeCampus").click(function(){o(this).hide(),o("#changeCampusSelectContainer").show()}),o("#changeCampusId").change(function(){var e=o(this).val();window.location="index.php?campusid="+e}),e=M.cfg.wwwroot,o(".editRpi").click(function(){o("#savePiBtn").unbind();var a=o(this).data("id"),t=o("#campusId").val();o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=getInfo&id="+a+"&campusid="+t,dataType:"json",success:function(e){console.log(e);var t=e.faqs,n=e.rooms;o("#piId").val(a),o("#buildingId").val(e.buildingid),o("#roomId").empty();for(var i=0;i<Object.keys(n).length;i++)o("<option value='"+n[i].id+"'>"+n[i].number+"</option>").appendTo("#roomId");o("#roomId").val(e.roomid),o("#faqId").empty();for(var i=0;i<Object.keys(t).length;i++)o("<option value='"+t[i].id+"'>"+t[i].name+"</option>").appendTo("#faqId");1==e.ignoreyes?(o("#ignoreDevice option[value=1]").attr("selected",!0),o("#ignoreDevice option[value=0]").attr("selected",!1)):(o("#ignoreDevice option[value=0]").attr("selected",!0),o("#ignoreDevice option[value=1]").attr("selected",!1)),o("#faqId").val(e.faqid),o("#buildingId").select2(),o("#roomId").select2(),o("#faqId").select2()},error:function(o){console.log(o)}}),o("#editModal").modal({show:!0,focus:!0}),o("#buildingId").change(function(){var a=o(this).val();o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=getRooms&buildingid="+a,dataType:"json",success:function(e){console.log(e[1].number),o("#roomId").empty();for(var a=0;a<Object.keys(e).length;a++)o("<option value='"+e[a].id+"'>"+e[a].number+"</option>").appendTo("#roomId");o("#roomId").select2()},error:function(o){console.log(o)}}),o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=getFaqs&buildingid="+a,dataType:"json",success:function(e){console.log(e[0].name),o("#faqId").empty();for(var a=0;a<Object.keys(e).length;a++)o("<option value='"+e[a].id+"'>"+e[a].name+"</option>").appendTo("#faqId")},error:function(o){console.log(o)}})}),o("#savePiBtn").click(function(){var a=o("#editPiForm").serialize();console.log(a),o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=save",data:a,dataType:"html",success:function(o){location.reload()},error:function(o){console.log(o)}})})}),function(){var e=M.cfg.wwwroot;o(".deleteRpi").click(function(){var a=o(this).data("id");console.log(a);var t=M.util.get_string("delete_confirmation","local_roomsupport");o("#delete-content").html(t),o("#deleteModal").modal({show:!0,focus:!0}),o("#deleteBtn").click(function(){o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=delete&id="+a,dataType:"text",success:function(o){location.reload()},error:function(o){console.log(o)}})})})}(),function(){var e=M.cfg.wwwroot;o(".deleteBuilding").click(function(){var a=o(this).data("id");console.log(a);var t=M.util.get_string("delete_building_confirmation","local_roomsupport");o("#delete-content").html(t),o("#deleteModal").modal({show:!0,focus:!0}),o("#deleteBtn").click(function(){o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=deleteBuilding&id="+a,dataType:"text",success:function(o){location.reload()},error:function(o){console.log(o)}})})})}(),function(){var e=M.cfg.wwwroot;o(".rebootRpi").click(function(){o(".rebootRpi").unbind();var a=o(this).data("id");console.log(a),o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=reboot&id="+a,dataType:"text",success:function(o){alert("System is rebooting"),t()},error:function(o){console.log(o)}})})}(),function(){var e=M.cfg.wwwroot;setInterval(function(){o(".modal").modal("hide"),o.ajax({url:e+"/local/roomsupport/ajax/dashboard.php?action=reload",dataType:"html",success:function(e){o("#deviceContainer").html(e),t()},error:function(o){console.log(o)}})},12e4)}()}return{init:function(){t()}}});