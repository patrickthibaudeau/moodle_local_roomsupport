define(["jquery","jqueryui","local_roomsupport/select2"],function(a,b,c){"use strict";function d(){e(),f(),g(),h(),i(),j()}function e(){a("#changeCampusSelectContainer").hide(),a("#changeCampus").click(function(){a(this).hide(),a("#changeCampusSelectContainer").show()}),a("#changeCampusId").change(function(){var b=a(this).val();window.location="index.php?campusid="+b})}function f(){var b=M.cfg.wwwroot;a(".editRpi").click(function(){a("#savePiBtn").unbind();var c=a(this).data("id"),d=a("#campusId").val();a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=getInfo&id="+c+"&campusid="+d,dataType:"json",success:function(b){console.log(b);var d=b.faqs,e=b.rooms;a("#piId").val(c),a("#buildingId").val(b.buildingid),a("#roomId").empty();for(var f=0;f<Object.keys(e).length;f++)a("<option value='"+e[f].id+"'>"+e[f].number+"</option>").appendTo("#roomId");a("#roomId").val(b.roomid),a("#faqId").empty();for(var f=0;f<Object.keys(d).length;f++)a("<option value='"+d[f].id+"'>"+d[f].name+"</option>").appendTo("#faqId");a("#faqId").val(b.faqid),a("#buildingId").select2(),a("#roomId").select2(),a("#faqId").select2()},error:function(a){console.log(a)}}),a("#editModal").modal({show:!0,focus:!0}),a("#buildingId").change(function(){var c=a(this).val();a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=getRooms&buildingid="+c,dataType:"json",success:function(b){console.log(b[1].number),a("#roomId").empty();for(var c=0;c<Object.keys(b).length;c++)a("<option value='"+b[c].id+"'>"+b[c].number+"</option>").appendTo("#roomId");a("#roomId").select2()},error:function(a){console.log(a)}}),a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=getFaqs&buildingid="+c,dataType:"json",success:function(b){console.log(b[0].name),a("#faqId").empty();for(var c=0;c<Object.keys(b).length;c++)a("<option value='"+b[c].id+"'>"+b[c].name+"</option>").appendTo("#faqId")},error:function(a){console.log(a)}})}),a("#savePiBtn").click(function(){var c=a("#editPiForm").serialize();console.log(c),a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=save",data:c,dataType:"html",success:function(a){location.reload()},error:function(a){console.log(a)}})})})}function g(){var b=M.cfg.wwwroot;a(".deleteRpi").click(function(){var c=a(this).data("id");console.log(c);var d=M.util.get_string("delete_confirmation","local_roomsupport");a("#delete-content").html(d),a("#deleteModal").modal({show:!0,focus:!0}),a("#deleteBtn").click(function(){a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=delete&id="+c,dataType:"text",success:function(a){location.reload()},error:function(a){console.log(a)}})})})}function h(){var b=M.cfg.wwwroot;a(".deleteBuilding").click(function(){var c=a(this).data("id");console.log(c);var d=M.util.get_string("delete_building_confirmation","local_roomsupport");a("#delete-content").html(d),a("#deleteModal").modal({show:!0,focus:!0}),a("#deleteBtn").click(function(){a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=deleteBuilding&id="+c,dataType:"text",success:function(a){location.reload()},error:function(a){console.log(a)}})})})}function i(){var b=M.cfg.wwwroot;a(".rebootRpi").click(function(){a(".rebootRpi").unbind();var c=a(this).data("id");console.log(c),a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=reboot&id="+c,dataType:"text",success:function(a){alert("System is rebooting"),d()},error:function(a){console.log(a)}})})}function j(){var b=M.cfg.wwwroot;setInterval(function(){a(".modal").modal("hide"),a.ajax({url:b+"/local/roomsupport/ajax/dashboard.php?action=reload",dataType:"html",success:function(b){a("#deviceContainer").html(b),d()},error:function(a){console.log(a)}})},12e4)}return{init:function(){d()}}});